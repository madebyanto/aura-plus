<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Utente</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
const firebaseConfig = {
    apiKey: "AIzaSyDsrHAtIh5bsYDHa1wz0LMcmciChAoRikU",
    authDomain: "myauraid-f03c6.firebaseapp.com",
    projectId: "myauraid-f03c6",
    storageBucket: "myauraid-f03c6.firebasestorage.app",
    messagingSenderId: "190478237725",
    appId: "1:190478237725:web:0d39907473f511b85a06f4"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
</script>
<style>
* {margin:0; padding:0; box-sizing:border-box;}
body {
    font-family:'Poppins',sans-serif;
    background: linear-gradient(135deg,#E30AF5,#F174FF);
    display:flex; justify-content:center; align-items:center;
    min-height:100vh; padding:20px;
}

.dashboard-card {
    background: rgba(255,255,255,0.15);
    border-radius: 20px;
    padding: 30px 20px;
    max-width: 500px;
    width: 100%;
    text-align: center;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    backdrop-filter: blur(15px);
}

#profile-img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 15px;
    border: 3px solid rgba(255,255,255,0.4);
}

h2 {
    font-size: 1.8em;
    margin-bottom:5px;
}

.user-name {
    font-size: 1.2em;
    font-weight: 400;
    color: #fff;
    opacity: 0.9;
    margin-bottom: 15px;
}

.saldo {font-weight:600; font-size:1.1em; margin:10px 0;}
.badge {padding:5px 10px; background-color:#007bff; color:white; border-radius:10px; display:inline-block; margin-top:10px;}
.btn-settings {
    margin-top:15px; padding:12px;
    background: #f174ff; color:#fff;
    border:none; border-radius:12px;
    font-size:16px; cursor:pointer;
    width:100%;
    transition: all 0.3s ease;
}
.btn-settings:hover {background:#e008f6;}
.bio-terminal {
    font-family:'Courier New', monospace;
    background: rgba(0,0,0,0.3);
    padding:15px;
    border-radius:12px;
    color:#e0e0e0;
    margin:15px 0;
    white-space: pre-wrap;
    overflow:hidden;
    border-left:4px solid #888;
    text-align:left;
    min-height:50px;
}
@media (max-width: 480px){
    .dashboard-card {padding:20px 15px;}
    #profile-img {width:100px; height:100px;}
    h2{font-size:1.5em;}
}
</style>
</head>
<body>
<div class="dashboard-card">
    <img id="profile-img" src="default-profile.png" alt="Immagine del profilo">
    <h2>Benvenuto</h2>
    <p class="user-name" id="user-name">Caricamento...</p>
    <p id="user-email"></p>
    <p>Saldo: <span id="saldo" class="saldo">Caricamento...</span></p>
    <div id="bio-display" class="bio-terminal"><span id="bio-text"></span></div>
    <p id="badge"></p>
    <p id="error-message" style="color:red;"></p>

    <button class="btn-settings" onclick="window.location.href='settings.html'">Impostazioni</button>
    <button class="btn-settings" onclick="window.location.href='personalize.html'">Personalizza</button>
    <button class="btn-settings" onclick="window.location.href='howtogetbalance.html'">Saldo e Wallet</button>
</div>

<script>
auth.onAuthStateChanged(function(user){
    if(user){
        db.collection("users").doc(user.uid).get().then(doc=>{
            if(doc.exists){
                const data = doc.data();
                document.getElementById('user-name').textContent = (data.nome && data.cognome) ? `${data.nome} ${data.cognome}` : "Nome Cognome";
                document.getElementById('user-email').textContent = "Email: "+user.email;
                document.getElementById('saldo').textContent = (data.saldo!==undefined)? data.saldo+" di saldo" : "0â‚¬";
                document.getElementById('profile-img').src = data.profileImage || 'aurastudio.png';
                // Bio animata
                const bioTextEl = document.getElementById('bio-text');
                const description = (data.bio && data.bio.description) ? data.bio.description : "Nessuna descrizione impostata.";
                let index=0;
                function typeWriter(){if(index<description.length){bioTextEl.textContent+=description.charAt(index); index++; setTimeout(typeWriter,25);}}
                bioTextEl.textContent=""; typeWriter();
                // Badge
                const badge = (data.badge && data.badge.trim()!=="") ? data.badge : "Utente";
                const badgeEl = document.getElementById('badge');
                badgeEl.textContent = "Badge: "+badge;
                badgeEl.classList.add('badge');
            }else{
                db.collection("users").doc(user.uid).set({saldo:15,profileImage:'aurastudio.png',badge:''});
            }
        }).catch(err=>{document.getElementById('error-message').textContent="Errore nel caricamento dei dati."; console.error(err);});
    }else{window.location.href="login.html";}
});
</script>
</body>
</html>